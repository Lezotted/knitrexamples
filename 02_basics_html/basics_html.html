<!--
 file:   basics_html.Rhtml
 author: Peter DeWitt, peter.dewitt@ucdenver.edu
 
 For:    Example Rnw file for creating a data analysis report using R, knitr,
 and html

 Please read the introduction section in this file, or the resulting pdf, for
 instructions on reproducing the data analysis report.  

 change log:
 12 Nov 2013 - File created 
-->

<html>
  <head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>




</head>

<body>

  <center> 
    <H1> Example Data Analysis Report Reproducible Research Using knitr with html </H1> 
  </center>

  <h2> Introduction </h2>

  <p>
This document serves as an example data analysis report generated using R for
the analysis, html for the markup report writing language, and knitr to bring
everything together.   The data set used is a fictitious as was generated for
example purposes only.  The purpose of this document is to provide an example of
reproducible research.  html is not the best markup language for a data analysis 
report, but it could be useful for other applications.
</p>

<p> <strong> Reproducing this report </strong>  These are the steps required for
reproducing this report.

<ol>
  <li> Install R on your computer. </li>

  <li>Open R, install the knitr package if the package is not on your system.
<div class="chunk" id="knitr_install"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">install.packages</span><span class="hl std">(</span><span class="hl str">&quot;knitr&quot;</span><span class="hl std">,</span> <span class="hl kwc">repos</span> <span class="hl std">=</span> <span class="hl str">&quot;http://cran.rstudio.com&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>

</li>

<li>Set the working directory in R to the same directory as this file exists
    in.  Run the following commands in R, 
<div class="chunk" id="knit_report"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(knitr)</span>
<span class="hl kwd">knit</span><span class="hl std">(</span><span class="hl kwc">input</span> <span class="hl std">=</span> <span class="hl str">&quot;basics_html.Rhtml&quot;</span><span class="hl std">)</span>
</pre></div>
</div></div>

</li>

<li>The above R code will generate the file basics_html.html.  View the page
in your favorite web browser</li>
  
</ol> 


<H2> Analysis Methods </H2>

<p>
Overall survival analysis was done using both
Kaplan-Meier estimates and Cox proportional hazard regression models.  
The analysis was done in <code class="knitr inline">R version 3.0.2 (2013-09-25)</code> and the
survival analysis was done using the survival package.
Statistical significance was set at the <!-- kalpha --> level.
</p>


<H2> Analysis and Results </H2>




<p>
The data set consisted of <code class="knitr inline">19,039</code>
records.  A summary of the data set is presented
in the table below.
</p>

<TABLE BORDER>
<tr><td><h3>Name</h3></td><td><h3>Overall</h3></td><td><h3></h3></td><td><h3>GS 7</h3></td><td><h3>GS 7</h3></td><td><h3>GS 8</h3></td><td><h3>GS 8</h3></td><td><h3>GS 9</h3></td><td><h3>GS 9</h3></td><td><h3>GS 10</h3></td><td><h3>GS 10</h3></td></tr>
<tr><td> </td><td>n</td><td>%</td><td>n</td><td>%</td><td>n</td><td>%</td><td>n</td><td>%</td><td>n</td><td>%</td></tr>
<tr><td>  </td><td>19,039</td><td></td><td>12,986</td><td>68.21</td><td>3,670</td><td>19.28</td><td>2,139</td><td>11.23</td><td>244</td><td>1.28</td></tr>
<tr><td>[40,50)</td><td>3,051</td><td>16.03</td><td>2,145</td><td>16.52</td><td>544</td><td>14.82</td><td>323</td><td>15.10</td><td>39</td><td>15.98</td></tr>
<tr><td>[50,70)</td><td>5,945</td><td>31.23</td><td>4,259</td><td>32.80</td><td>1,005</td><td>27.38</td><td>608</td><td>28.42</td><td>73</td><td>29.92</td></tr>
<tr><td>[70,85]</td><td>10,043</td><td>52.75</td><td>6,582</td><td>50.69</td><td>2,121</td><td>57.79</td><td>1,208</td><td>56.47</td><td>132</td><td>54.10</td></tr>
<tr><td>Era 1</td><td>8,615</td><td>45.25</td><td>5,869</td><td>45.19</td><td>1,659</td><td>45.20</td><td>970</td><td>45.35</td><td>117</td><td>47.95</td></tr>
<tr><td>Era 2</td><td>10,424</td><td>54.75</td><td>7,117</td><td>54.81</td><td>2,011</td><td>54.80</td><td>1,169</td><td>54.65</td><td>127</td><td>52.05</td></tr>
<tr><td>[0, 10) ng/ml</td><td>11,567</td><td>60.75</td><td>8,410</td><td>64.76</td><td>1,997</td><td>54.41</td><td>1,038</td><td>48.53</td><td>122</td><td>50.00</td></tr>
<tr><td>[10, 20) ng/ml</td><td>4,372</td><td>22.96</td><td>2,845</td><td>21.91</td><td>927</td><td>25.26</td><td>531</td><td>24.82</td><td>69</td><td>28.28</td></tr>
<tr><td>[20, Inf) ng/ml</td><td>3,100</td><td>16.28</td><td>1,731</td><td>13.33</td><td>746</td><td>20.33</td><td>570</td><td>26.65</td><td>53</td><td>21.72</td></tr>
<tr><td>T Stage 1</td><td>9,668</td><td>50.78</td><td>7,110</td><td>54.75</td><td>1,699</td><td>46.29</td><td>770</td><td>36.00</td><td>89</td><td>36.48</td></tr>
<tr><td>T Stage 2</td><td>8,189</td><td>43.01</td><td>5,360</td><td>41.28</td><td>1,657</td><td>45.15</td><td>1,065</td><td>49.79</td><td>107</td><td>43.85</td></tr>
<tr><td>T Stage 3/4</td><td>1,182</td><td>6.21</td><td>516</td><td>3.97</td><td>314</td><td>8.56</td><td>304</td><td>14.21</td><td>48</td><td>19.67</td></tr>
<tr><td>Observed Death</td><td>2,755</td><td></td><td>1,611</td><td></td><td>598</td><td></td><td>473</td><td></td><td>73</td><td></td></tr>
</TABLE>




<div class="chunk" id="km_plot"><div class="rimage default"><img src="figure/km_plot.png" title="plot of chunk km_plot" alt="plot of chunk km_plot" class="plot" /></div></div>


<p>
We are primarily interested in the differences in survival between patients with
different Gleason scores.  The figure below presents the Kaplan-Meier
survival estimates by Gleason score.  As expected, the higher the Gleason score,
the worse the survival.  It should also be noted that even after seven years of
tracking patients the median survival time is not estimable.  The lowest
survival estimate is <code class="knitr inline">63.43</code>%.
</p>

<p>
Both univariable and multivariable Cox proportional hazard regression models
were fitted for overall survival by the age, era of treatment, T stage, PSA, and
Gleason score of the patient.  Results for all the regression models are
presented in table below.
</p>

<TABLE BORDER>
<tr><td><h3>Name</h3></td><td><h3>Univar HR</h3></td><td><h3>LCL</h3></td><td><h3>UCL</h3></td><td><h3>Pval</h3></td><td><h3>Multivar HR</h3></td><td><h3>LCL</h3></td><td><h3>UCL</h3></td><td><h3>Pval</h3></td></tr>
<tr><td>[40,50)</td><td>Reference</td><td></td><td></td><td></td><td>Reference</td><td></td><td></td><td></td></tr>
<tr><td>[50,70)</td><td>0.95</td><td>0.84</td><td>1.09</td><td>0.4807</td><td>0.96</td><td>0.84</td><td>1.10</td><td>0.5550</td></tr>
<tr><td>[70,85]</td><td>1.62</td><td>1.44</td><td>1.81</td><td>&lt 0.0001</td><td>1.61</td><td>1.43</td><td>1.80</td><td>&lt 0.0001</td></tr>
<tr><td>Era 1</td><td>Reference</td><td></td><td></td><td></td><td>Reference</td><td></td><td></td><td></td></tr>
<tr><td>Era 2</td><td>0.83</td><td>0.76</td><td>0.90</td><td>&lt 0.0001</td><td>0.84</td><td>0.77</td><td>0.92</td><td>&lt 0.0001</td></tr>
<tr><td>T Stage 1</td><td>Reference</td><td></td><td></td><td></td><td>Reference</td><td></td><td></td><td></td></tr>
<tr><td>T Stage 2</td><td>1.19</td><td>1.10</td><td>1.29</td><td>&lt 0.0001</td><td>1.12</td><td>1.03</td><td>1.21</td><td>0.0063</td></tr>
<tr><td>T Stage 3/4</td><td>1.54</td><td>1.34</td><td>1.77</td><td>&lt 0.0001</td><td>1.24</td><td>1.07</td><td>1.43</td><td>0.0033</td></tr>
<tr><td>[0, 10) ng/ml</td><td>Reference</td><td></td><td></td><td></td><td>Reference</td><td></td><td></td><td></td></tr>
<tr><td>[10, 20) ng/ml</td><td>1.45</td><td>1.32</td><td>1.58</td><td>&lt 0.0001</td><td>1.36</td><td>1.24</td><td>1.48</td><td>&lt 0.0001</td></tr>
<tr><td>[20, Inf) ng/ml</td><td>1.62</td><td>1.47</td><td>1.78</td><td>&lt 0.0001</td><td>1.50</td><td>1.36</td><td>1.66</td><td>&lt 0.0001</td></tr>
<tr><td>GS 7</td><td>Reference</td><td></td><td></td><td></td><td>Reference</td><td></td><td></td><td></td></tr>
<tr><td>GS 8</td><td>1.34</td><td>1.22</td><td>1.47</td><td>&lt 0.0001</td><td>1.23</td><td>1.12</td><td>1.35</td><td>&lt 0.0001</td></tr>
<tr><td>GS 9</td><td>1.92</td><td>1.73</td><td>2.12</td><td>&lt 0.0001</td><td>1.73</td><td>1.55</td><td>1.91</td><td>&lt 0.0001</td></tr>
<tr><td>GS 10</td><td>2.74</td><td>2.17</td><td>3.46</td><td>&lt 0.0001</td><td>2.48</td><td>1.96</td><td>3.14</td><td>&lt 0.0001</td></tr>
</TABLE>






<p>
The results of a univariable regression model indicated that 
Patients treated in Era 2 had statistically better survival than patients
treated in Era 1, 
HR = <code class="knitr inline">0.83 (95\% CI: 0.76,0.90)</code>, 
and there was no
appreciable difference in the hazard ratio found in the multivariable
regression model, 
HR = <code class="knitr inline">0.84 (95\% CI: 0.77,0.92)</code>.  As expected, as
patients increase in age, T Stage increase, PSA increase, and Gleason score
increases, the hazard also increases.
</p>

<p>
The hazard ratio between Gleason 8 and Gleason 7, from the multivariable Cox
proportional hazard regression model, is 
HR = <code class="knitr inline">1.23 (95\% CI: 1.12,1.35)</code>.  
Further analysis of the pairwise comparisons of the hazards between all
four Gleason scores can be provided upon request.
</p>


<H2> Concluions </H2>
<p>
The conclusions section for a data analysis report would generally be used to
summarize the results presented in the analysis and results section, list any
limitations to the study, and generate some discussion topics.  Seeing how the
purpose of this report was to show illustrate the use of knitr, the
conclusions will focus on reproducible research.
</p>

<p>
Using {\tt knitr} to write data analysis reports were the written report and the
data analysis methods is a version of literate programming.  When written well,
the report are robust to changes in the data set, but more importantly, every
element of the report is commented directly or contextually.  
</p>

<p>
In addition to using knitr, a very powerful tool for authoring reports,
both as a sole author, or as a collaboration, is to use version control
software.  I prefer git, but another
viable option is subversion.  RStudio has built-in features to working with
either.  Repository hosting on github.com or bitbucket.org are helpful, but on
public servers (private repos are possible, but think about the physical
location of the data storage).  The git server software can be purchased and set
up behind institutional firewalls.  
</p>




<div class="chunk" id="session_info"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl com"># for reproducability, print out the session infor for the packages, and</span>
<span class="hl com"># versions of the packages, used to run the anlaysis and create this</span>
<span class="hl com"># document.</span>
<span class="hl kwd">print</span><span class="hl std">(</span><span class="hl kwd">sessionInfo</span><span class="hl std">(),</span> <span class="hl kwc">local</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.0.2 (2013-09-25)
## Platform: x86_64-pc-linux-gnu (64-bit)
## 
## attached base packages:
## [1] splines   stats     graphics  grDevices utils     datasets  methods  
## [8] base     
## 
## other attached packages:
## [1] gdata_2.13.2    Hmisc_3.12-2    Formula_1.1-1   survival_2.37-4
## [5] knitr_1.5       vimcom_0.9-9    setwidth_1.0-3  colorout_1.0-0 
## 
## loaded via a namespace (and not attached):
##  [1] cluster_1.14.4  evaluate_0.4.7  formatR_0.9     grid_3.0.2     
##  [5] gtools_3.1.0    highr_0.2.1     lattice_0.20-24 rpart_4.1-3    
##  [9] stringr_0.6.2   tools_3.0.2
</pre></div>
</div></div>


</body>
</html>
